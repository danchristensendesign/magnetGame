<!DOCTYPE html>
<html>



<body>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<div id="canvDiv" class="unselectable" style="position:absolute;">
	<canvas id="backCanv" style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
	<canvas id="midCanv" style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
	<canvas id="frontCanv" oncontextmenu="return false;" style="position: absolute; left: 0; top: 0; z-index: 2;"></canvas>	
</div>



<script>

const R = -10000;
const screenR = .635;
const screenW = (window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth);
const screenH = (window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight);
const actH = Math.min(screenH, screenW / screenR);
const actW = (actH *screenR);
var mainDiv = document.getElementById("canvDiv");
mainDiv.style.left = 0 + 'px';
mainDiv.style.top = 0 + 'px';
const offX = (screenW - actW)/2;
const offY = (screenH - actH)/2;

var backCanv = document.getElementById("backCanv");
backCanv.width = screenW;
backCanv.height = screenH;
var backCx = backCanv.getContext("2d");

var midCanv = document.getElementById("midCanv");
midCanv.width = screenW;
midCanv.height = screenH;
var midCx = midCanv.getContext("2d");


var frontCanv = document.getElementById("frontCanv");
frontCanv.width = screenW;
frontCanv.height = screenH;
var frontCx = frontCanv.getContext("2d");

document.addEventListener("mousemove", updateHover);
document.addEventListener("mousedown", updateClick);
document.addEventListener("mouseup", updateClick);

function touchMove(e) {
    e.preventDefault(); 
	updateHover(e);
};

document.addEventListener("touchmove", touchMove, {passive: false});
document.addEventListener("touchstart", updateClick);
document.addEventListener("touchend", updateClick);


function gameToScreen(game, isX)
{
	if(isX) return (game /100 * actW);
	else return (game/100 * actH);
}

function magnet(arr){
	this.x = arr[0];
	this.y = arr[1];
	this.r = arr[2];
	
	this.sx = gameToScreen(arr[0], true);
	this.sy = gameToScreen(arr[1], false);
	this.sr = gameToScreen(arr[2], true);
	
	this.isOn = false;
}

var magnets = {
	arr: [],
	init: function(newArr) 
	{
		this.arr = [];
		var len = newArr.length;
		for (var i = 0; i < len; i++) 
		{
			this.arr.push(new magnet(newArr[i]));
		}
	}
}








var player = {
	r: 0,
	pos: {x: 0, y: 0},
	vel: {x: 0, y: 0},
	
	sr:0,
	spos: {x: 0, y: 0},
	
	init: function(arr)
	{
		this.pos.x = arr[0]; 
		this.pos.y = arr[1];
		this.r = arr[2];
		this.sr = gameToScreen(arr[2], true);
		this.vel.x = 0;
		this.vel.y = 0;
		this.update();
	},
	
	update: function()
	{
		this.spos.x = gameToScreen(this.pos.x, true);
		this.spos.y = gameToScreen(this.pos.y, false);
	}
		
};

var worm = {
	x: 0, 
	y: 0,
	r: 0, 
	
	sx: 0, 
	sy: 0,
	sr: 0,
	init: function(arr)
	{
		this.x = arr[0];
		this.y = arr[1];
		this.r = arr[2];
		
		this.sx = gameToScreen(arr[0], true);
		this.sy = gameToScreen(arr[1], false);
		this.sr = gameToScreen(arr[2], true);
	}
};

var magDefs = [
	[30,15,15],
	[70,15, 15]

];
var playerDef = [50,85,3];
var wormDef = [50,30,6];

player.init(playerDef);
magnets.init(magDefs);
worm.init(wormDef);
//player.vel.y = -100;
var lastTime = new Date().getTime();
drawT();

function drawT()
{
	midCx.fillStyle = 'RGB(233, 233, 233)';
	for(var i = 0; i < magnets.arr.length; i+= 1)
	{
		drawCircle(midCx, magnets.arr[i].sx, magnets.arr[i].sy, magnets.arr[i].sr);
	}
	drawCircle(midCx, worm.sx, worm.sy, worm.sr);
}

function drawCircle(cx, x, y, r)
{
	cx.beginPath();
	cx.arc(x + offX , y + offY, r, 0, 2 * Math.PI);
	cx.fill();
}

function drawPlayer()
{
	frontCx.fillStyle = 'RGB(255,255,255)';
	frontCx.clearRect(0, 0, screenW, screenH);
	drawCircle(frontCx, player.spos.x, player.spos.y, player.sr);
}

	
function updateHover(event)
{
	//console.log('h');
	pos(event);
}

function updateClick(event)
{
	pos(event);
}

function pos(event)
{
	if(event.type.substr(0,5) === 'mouse')
	{
		//console.log('a');
		checkIt([event.clientX - offX, event.clientY - offY]);
	}
	else
	{
		for (i=0; i < event.touches.length; i++) 
		{  
			checkIt([event.touches[i].pageX - offX, event.touches[i].pageY - offY]);
		}
	}	
}

function checkIt(arr)
{
	for(var i = 0; i < magnets.arr.length; i+=1 )
	{
		var mag = magnets.arr[i];
		if(distance(arr[0], arr[1], mag.sx, mag.sy) <= mag.sr)
		{
			mag.isOn = true;
			console.log('on');
		}
		else
		{
			mag.isOn = false;
			console.log('off');
		}
	}
}
/* function drawIt(xy)
{
	if(xy[0] > offX && xy[0] < (screenW - offX) && xy[1] > offY && xy[1] < (screenH - offY))
	{
		frontCx.fillStyle = 'RGB(200,0,0)';
		frontCx.beginPath();
		frontCx.arc(xy[0], xy[1], 5, 0, 2 * Math.PI);
		frontCx.fill();
	}
	console.log("d");
} */

backCx.fillStyle = 'RGB(0,0,0)';
backCx.fillRect(offX,offY,actW, actH);

requestAnimationFrame(updateFrame);



function updateFrame()
{
	var newTime = new Date().getTime();
	var dt = (newTime - lastTime)/1000;
	lastTime = newTime;
	
	//sum forces on player
	var fx = 0;
	var fy = 0;
	
	for(var i = 0; i < magnets.arr.length; i+=1 )
	{
		if(magnets.arr[i].isOn)
		{
			var mag = magnets.arr[i];
			var dx = player.spos.x - mag.sx;
			var dy = player.spos.y - mag.sy;
			var d = Math.pow(Math.pow(dx, 2) + Math.pow(dy, 2), 1/2);
			var fMag = R * mag.sr / Math.pow(d, 1.4);
			var theta = Math.atan2(dy, dx);
			fx += Math.cos(theta) * fMag;
			fy += Math.sin(theta) * fMag;
		}
	}
	player.vel.x += fx * dt;
	player.vel.y += fy * dt;
	player.spos.x += player.vel.x * dt;
	player.spos.y += player.vel.y * dt;
	drawPlayer();
			

	requestAnimationFrame(updateFrame);
}

function distance(x1, y1, x2, y2)
{
	return Math.pow(Math.pow(x2-x1, 2) + Math.pow(y2-y1, 2), 1/2);
}
</script>

</body>

</html> 
