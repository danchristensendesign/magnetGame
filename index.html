<!DOCTYPE html>
<html>



<body style="-webkit-overflow-scrolling: auto;">

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<div id="canvDiv" class="unselectable" style="position:absolute;">
	<canvas id="backCanv" style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
	<canvas id="midCanv" style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
	<canvas id="frontCanv" oncontextmenu="return false;" style="position: absolute; left: 0; top: 0; z-index: 2;"></canvas>	
</div>



<script>
const scrollAmt = 150;
const playerCol = 'RGB(230,230,230)';
const magOffCol = 'RGB(111,183,214)';
const magOnCol = 'RGB(133,292,93)';
const magRingCol = 'RGB(100, 170, 200)';//'RGB(251,182,209)';
const wormCol =  'RGB(30,30,255)';// 'RGB(0,0, 200)';
const wormRingCol = 'RGB(192,5,248)';
const AID = 3;
const playing = 0;
const winning = 1;
const dying = 2;
const won = 3;
const R = -100;
const screenR = .635;
var screenW = (window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth);
var screenH = (window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight);
var actH = Math.min(screenH, screenW / screenR);
var actW = (actH *screenR);
var mainDiv = document.getElementById("canvDiv");
mainDiv.style.left = 0 + 'px';
mainDiv.style.top = 0 + 'px';
const offX = (screenW - actW)/2;
const offY = (screenH - actH)/2;

var backCanv = document.getElementById("backCanv");
backCanv.width = screenW;
backCanv.height = screenH + scrollAmt;
var backCx = backCanv.getContext("2d");

var midCanv = document.getElementById("midCanv");
midCanv.width = screenW;

var midCx = midCanv.getContext("2d");


var frontCanv = document.getElementById("frontCanv");
frontCanv.width = screenW;
frontCanv.height = screenH;
var frontCx = frontCanv.getContext("2d");

document.addEventListener("mousemove", updateClick);
document.addEventListener("mousedown", updateClick);
document.addEventListener("mouseup", updateClick);
var isPlaying = false;
var maxFound = false;
var maxH = screenH;
var lastY = null;
var isTouch = false;
var inCorner = false;

//document.addEventListener("touchmove", touchMove, {passive: false});
document.addEventListener("touchstart", updateClick);
document.addEventListener("touchend", updateClick);
document.addEventListener("touchmove", updateClick);

var animStr = "waiting";

setTimeout(function () {
	window.scrollTo(0, 0);
	screenH = (window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight);
	screenW = (window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth);
	screenH = (window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight);
	actH = Math.min(screenH, screenW / screenR);
	actW = (actH *screenR);
	backCanv.height = screenH + scrollAmt;
	midCanv.height = screenH + scrollAmt;
}, 300);

var ignoreDef = false;

function updateClick(e)
{
	var curH = (window.innerHeight);// || document.documentElement.clientHeight || document.body.clientHeight);
	
	/* if(event.type === "touchend")
	{
		isTouch = false;
	}
	else  */
	/* if(e.type === "touchstart")
	{
		ignoreDef = (curH > screenH && (e.touches[i].pageY > 100 || e.touches[i].pageX > 100));
		midCx.clearRect(0, 0, midCanv.width, midCanv.height);
		midCx.beginPath();	
		midCx.strokeText(ignoreDef, e.touches[0].pageX, 400);
	} */
	midCx.fillStyle = 'RGB(0, 0, 0)';
	

	{

		midCx.clearRect(0, 0, midCanv.width, midCanv.height);
		midCx.beginPath();	
		midCx.strokeText(e.type, e.touches[0].pageX, 400);
	}
	if(e.type === "touchstart")
	{
		ignoreDef = (curH > screenH && (e.touches[i].pageY > 100 || e.touches[i].pageX > 100));
		midCx.beginPath();	
		midCx.strokeText(ignoreDef, e.touches[0].pageX, 440);
	}
	
	//if(ignoreDef) e.preventDefault();
	/* if(e.touches)
	{
		midCx.clearRect(0, 0, midCanv.width, midCanv.height);
		midCx.beginPath();	
		midCx.strokeText(ignoreDef, e.touches[0].pageX, e.touches[0].pageY + 50);
	} */
		
		
	
/* 	if(e.touches)
	{
		midCx.clearRect(0, 0, midCanv.width, midCanv.height);
		var tp = (window.pageYOffset || document.documentElement.scrollTop);
		midCx.fillStyle = 'RGB(200, 100, 100)';
		midCx.beginPath();
		midCx.arc(e.touches[0].pageX, e.touches[0].pageY , 9, 0, 2* Math.PI);
		midCx.fill();
	} */
		
	

	
/* 	if(e.type === "touchend")
	{
		if(maxFound && curH >= maxH)
		{
			animStr = "playing";
			isPlaying = true;
		}
		else
		{
			var outH =  window.outerHeight;
			isPlaying = false;
			animStr = curH + ', ' + maxH + ', ' + outH + " paused, waiting";
		}
		return;
	}
	
	
	if(isPlaying)
	{
		switch(e.type)
		{
			case "touchstart": 
				animStr = "possible pause";
				break;
				
			case "touchmove":
				if(curH < maxH) 
				{
					animStr = "leading to pause";
				}
				else
				{
					animStr = "ready to play";
				}
				break;
				
			case "touchend":
				if(curH < maxH)
				{
					animStr = "paused";
					isPlaying = false;
				}
				else
				{
					animStr = "playing";
				}
				break;
		}
	}
	else
	{
		if(e.touches)
		{
			var delY = e.touches[0].pageY - lastY;
			lastY = e.touches[0].pageY;
		}
		switch(e.type)
		{
			case "touchstart": 
				animStr = "possible start";
				
				break;
				
			case "touchmove":
				if(!maxFound)
				{
					if(delY < 0)
					{
						if(curH > maxH)
						{
							maxH = curH;
							animStr = "growing";
						}
						else if(curH === maxH && curH > screenH) 
						{
							maxFound = true;
							animStr = "max found";
						}
						else
						{
							animStr = "maybe growing";
						}
					}
					else
					{
						animStr = "maybe growing maybe not";
					}
				}
				else if(curH === maxH)
				{
					animStr = "ready to play";
				}
				else
				{
					animStr = "leading to pause";
				}
				
				break;
				
			
		
		}
	} */
}
var off = 0;
var inc = 1;
var rectLW = screenW/3;
var rectH = screenH* .6;
var rectT = screenH* .2;
var boxH = rectH - scrollAmt;
animate();

function animate()
{
	var curH = (window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight);
	
	//isPlaying = (maxFound && curH === maxH);
	//if(isPlaying) animStr = "playing";
	var tp = (window.pageYOffset || document.documentElement.scrollTop);
	backCx.clearRect(0, 0, backCanv.width, backCanv.height);
	backCx.font="30px Verdana"
	backCx.beginPath();
	backCx.strokeStyle = 'RGB(0,0,0)';
	//backCx.strokeText(animStr, 10, 400 + tp + off);
	//if((off > 100 && inc > 0) || (off < -100 && inc < 0)) inc = -inc;
	//off += inc;
	
	if(curH > screenH)
	{
		backCx.fillRect(1, tp, 100, 100);
		
	}
	else
	{
		backCx.strokeRect(rectLW, rectT + tp, rectLW, rectH);
		backCx.strokeText(curH + ', ' + screenH, rectLW, rectT);
		backCx.fillRect(rectLW, Math.min(rectT + tp + rectH - boxH, Math.max(rectT + tp, rectT + rectH - boxH - tp)), rectLW, boxH);
		
	}
	
	requestAnimationFrame(animate);
}


/* function updateClick(e)
{
	pos(e);
} */

/* function pos(e)
{

		

	{

		if(e.type.substr(0,5) === 'mouse')
		{
			checkIt([e.clientX - offX, e.clientY - offY]);
		}
		else
		{
			for (i=0; i < e.touches.length; i++) 
			{  
				if(e.type === "touchend")
				{
					lastY = null;
				}
				else
				{
					var state = "";
					if(lastY !== null)
					{
						var curH = (window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight);
						var tp = window.pageYOffset || document.documentElement.scrollTop;
						
						var delY = e.touches[i].pageY - lastY;
						if(delY <= 0)
						{
							if(curH > maxH)
							{
								maxH = curH;
								state = "growing";
							}
							else 
							{
								//e.preDefault();
								state = "started";
							}
						}
						else
						{
							state = "shrinking";
						}
						
					}
					lastY = e.touches[i].pageY;
					backCx.clearRect(0,0, backCanv.width, backCanv.height);
					backCx.font="30px Verdana"
					backCx.beginPath();
					backCx.strokeStyle = 'RGB(0,0,0)';
					backCx.strokeText(e.touches[i].pageY + ', ' + state +  ', ' + curH, 10, 400 + tp);
				}
				
			}
		}	
	}
}

function checkIt(arr)
{
	var curH = (window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight);
	var tp = window.pageYOffset || document.documentElement.scrollTop;
	backCx.clearRect(0,0, backCanv.width, backCanv.height);
	backCx.font="30px Verdana"
	backCx.beginPath();
	backCx.strokeStyle = 'RGB(0,0,0)';
	backCx.strokeText(curH + ', ' + tp, 10, 400);
		/* else
		{
			mag.isOn = false;
			console.log('off');
		} 
	
} */

</script>

</body>

</html> 
