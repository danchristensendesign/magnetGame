<!DOCTYPE html>
<html>



<body>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<div id="canvDiv" class="unselectable" style="position:absolute;">
	<canvas id="backCanv" style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
	<canvas id="midCanv" style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
	<canvas id="frontCanv" oncontextmenu="return false;" style="position: absolute; left: 0; top: 0; z-index: 2;"></canvas>	
</div>



<script>

const playerCol = 'RGB(230,230,230)';
const magOffCol = 'RGB(111,183,214)';
const magOnCol = 'RGB(133,292,93)';
const magRingCol = 'RGB(100, 170, 200)';//'RGB(251,182,209)';
const wormCol =  'RGB(30,30,255)';// 'RGB(0,0, 200)';
const wormRingCol = 'RGB(192,5,248)';
const AID = 3;
const playing = 0;
const winning = 1;
const dying = 2;
const won = 3;
const R = -100;
const screenR = .635;
const screenW = (window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth);
const screenH = (window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight);
const actH = Math.min(screenH, screenW / screenR);
const actW = (actH *screenR);
var mainDiv = document.getElementById("canvDiv");
mainDiv.style.left = 0 + 'px';
mainDiv.style.top = 0 + 'px';
const offX = (screenW - actW)/2;
const offY = (screenH - actH)/2;

var backCanv = document.getElementById("backCanv");
backCanv.width = screenW;
backCanv.height = screenH + 300;
var backCx = backCanv.getContext("2d");

var midCanv = document.getElementById("midCanv");
midCanv.width = screenW;
midCanv.height = screenH;
var midCx = midCanv.getContext("2d");


var frontCanv = document.getElementById("frontCanv");
frontCanv.width = screenW;
frontCanv.height = screenH;
var frontCx = frontCanv.getContext("2d");

document.addEventListener("mousemove", updateClick);
document.addEventListener("mousedown", updateClick);
document.addEventListener("mouseup", updateClick);
var isGoing = false;
var maxH = screenH;
var lastY = null;

function touchMove(e) {
    //e.preventDefault(); 
	updateClick(e);
};

//document.addEventListener("touchmove", touchMove, {passive: false});
document.addEventListener("touchstart", updateClick);
document.addEventListener("touchend", updateClick);
document.addEventListener("touchmove", updateClick);


function updateClick(event)
{
	pos(event);
}

function pos(event)
{

		

	{

		if(event.type.substr(0,5) === 'mouse')
		{
			checkIt([event.clientX - offX, event.clientY - offY]);
		}
		else
		{
			for (i=0; i < event.touches.length; i++) 
			{  
				if(event.type === "touchend")
				{
					lastY = null;
				}
				else
				{
					var state = "";
					if(lastY !== null)
					{
						var curH = (window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight);
						var tp = window.pageYOffset || document.documentElement.scrollTop;
						
						var delY = event.touches[i].pageY - lastY;
						if(delY < 0)
						{
							if(curH > maxH)
							{
								maxH = curH;
								state = "growing";
							}
							else 
							{
								//e.preventDefault();
								state = "started";
							}
						}
						else
						{
							state = "shrinking";
						}
						
					}
					lastY = event.touches[i].pageY;
					backCx.clearRect(0,0, backCanv.width, backCanv.height);
					backCx.font="30px Verdana"
					backCx.beginPath();
					backCx.strokeStyle = 'RGB(0,0,0)';
					backCx.strokeText(event.touches[i].pageY + ', ' + state +  ', ' + curH, 10, 400 + tp);
				}
				
			}
		}	
	}
}

function checkIt(arr)
{
	var curH = (window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight);
	var tp = window.pageYOffset || document.documentElement.scrollTop;
	backCx.clearRect(0,0, backCanv.width, backCanv.height);
	backCx.font="30px Verdana"
	backCx.beginPath();
	backCx.strokeStyle = 'RGB(0,0,0)';
	backCx.strokeText(curH + ', ' + tp, 10, 400);
		/* else
		{
			mag.isOn = false;
			console.log('off');
		} */
	
}

</script>

</body>

</html> 
